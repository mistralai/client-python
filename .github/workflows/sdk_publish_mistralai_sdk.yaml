name: Publish MISTRALAI-SDK
permissions:
  checks: write
  contents: write
  pull-requests: write
  statuses: write
"on":
  workflow_dispatch:
    inputs:
      confirm_publish:
        description: 'WARNING: This will publish v2 SDK (mistralai.client namespace) which is still WIP/alpha. To publish v1 (mistralai namespace), use the v1 branch instead. Type "publish" to confirm.'
        required: false
        type: string
  push:
    branches:
      - v1
    paths:
      - RELEASES.md
      - "*/RELEASES.md"
jobs:
  publish:
    # Auto-publish from v1 branch; require manual confirmation from main
    if: |
      github.ref == 'refs/heads/v1' ||
      (github.event_name == 'workflow_dispatch' && github.event.inputs.confirm_publish == 'publish')
    uses: speakeasy-api/sdk-generation-action/.github/workflows/sdk-publish.yaml@7951d9dce457425b900b2dd317253499d98c2587 # v15
    secrets:
      github_access_token: ${{ secrets.GITHUB_TOKEN }}
      pypi_token: ${{ secrets.PYPI_TOKEN }}
      speakeasy_api_key: ${{ secrets.SPEAKEASY_API_KEY }}
